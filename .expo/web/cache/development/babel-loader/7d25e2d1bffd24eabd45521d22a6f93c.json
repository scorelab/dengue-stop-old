{"ast":null,"code":"'use strict';\n\nvar inherits = require('inherits'),\n    JSON3 = require('json3'),\n    EventEmitter = require('events').EventEmitter,\n    version = require(\"../version\"),\n    urlUtils = require(\"../utils/url\"),\n    iframeUtils = require(\"../utils/iframe\"),\n    eventUtils = require(\"../utils/event\"),\n    random = require(\"../utils/random\");\n\nvar debug = function debug() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:transport:iframe');\n}\n\nfunction IframeTransport(transport, transUrl, baseUrl) {\n  if (!IframeTransport.enabled()) {\n    throw new Error('Transport created when disabled');\n  }\n\n  EventEmitter.call(this);\n  var self = this;\n  this.origin = urlUtils.getOrigin(baseUrl);\n  this.baseUrl = baseUrl;\n  this.transUrl = transUrl;\n  this.transport = transport;\n  this.windowId = random.string(8);\n  var iframeUrl = urlUtils.addPath(baseUrl, '/iframe.html') + '#' + this.windowId;\n  debug(transport, transUrl, iframeUrl);\n  this.iframeObj = iframeUtils.createIframe(iframeUrl, function (r) {\n    debug('err callback');\n    self.emit('close', 1006, 'Unable to load an iframe (' + r + ')');\n    self.close();\n  });\n  this.onmessageCallback = this._message.bind(this);\n  eventUtils.attachEvent('message', this.onmessageCallback);\n}\n\ninherits(IframeTransport, EventEmitter);\n\nIframeTransport.prototype.close = function () {\n  debug('close');\n  this.removeAllListeners();\n\n  if (this.iframeObj) {\n    eventUtils.detachEvent('message', this.onmessageCallback);\n\n    try {\n      this.postMessage('c');\n    } catch (x) {}\n\n    this.iframeObj.cleanup();\n    this.iframeObj = null;\n    this.onmessageCallback = this.iframeObj = null;\n  }\n};\n\nIframeTransport.prototype._message = function (e) {\n  debug('message', e.data);\n\n  if (!urlUtils.isOriginEqual(e.origin, this.origin)) {\n    debug('not same origin', e.origin, this.origin);\n    return;\n  }\n\n  var iframeMessage;\n\n  try {\n    iframeMessage = JSON3.parse(e.data);\n  } catch (ignored) {\n    debug('bad json', e.data);\n    return;\n  }\n\n  if (iframeMessage.windowId !== this.windowId) {\n    debug('mismatched window id', iframeMessage.windowId, this.windowId);\n    return;\n  }\n\n  switch (iframeMessage.type) {\n    case 's':\n      this.iframeObj.loaded();\n      this.postMessage('s', JSON3.stringify([version, this.transport, this.transUrl, this.baseUrl]));\n      break;\n\n    case 't':\n      this.emit('message', iframeMessage.data);\n      break;\n\n    case 'c':\n      var cdata;\n\n      try {\n        cdata = JSON3.parse(iframeMessage.data);\n      } catch (ignored) {\n        debug('bad json', iframeMessage.data);\n        return;\n      }\n\n      this.emit('close', cdata[0], cdata[1]);\n      this.close();\n      break;\n  }\n};\n\nIframeTransport.prototype.postMessage = function (type, data) {\n  debug('postMessage', type, data);\n  this.iframeObj.post(JSON3.stringify({\n    windowId: this.windowId,\n    type: type,\n    data: data || ''\n  }), this.origin);\n};\n\nIframeTransport.prototype.send = function (message) {\n  debug('send', message);\n  this.postMessage('m', message);\n};\n\nIframeTransport.enabled = function () {\n  return iframeUtils.iframeEnabled;\n};\n\nIframeTransport.transportName = 'iframe';\nIframeTransport.roundTrips = 2;\nmodule.exports = IframeTransport;","map":{"version":3,"sources":["C:/Users/Thivagar/AppData/Roaming/npm/node_modules/expo-cli/node_modules/sockjs-client/lib/transport/iframe.js"],"names":["inherits","require","JSON3","EventEmitter","version","urlUtils","iframeUtils","eventUtils","random","debug","process","env","NODE_ENV","IframeTransport","transport","transUrl","baseUrl","enabled","Error","call","self","origin","getOrigin","windowId","string","iframeUrl","addPath","iframeObj","createIframe","r","emit","close","onmessageCallback","_message","bind","attachEvent","prototype","removeAllListeners","detachEvent","postMessage","x","cleanup","e","data","isOriginEqual","iframeMessage","parse","ignored","type","loaded","stringify","cdata","post","send","message","iframeEnabled","transportName","roundTrips","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\n// Few cool transports do work only for same-origin. In order to make\n// them work cross-domain we shall use iframe, served from the\n// remote domain. New browsers have capabilities to communicate with\n// cross domain iframe using postMessage(). In IE it was implemented\n// from IE 8+, but of course, IE got some details wrong:\n//    http://msdn.microsoft.com/en-us/library/cc197015(v=VS.85).aspx\n//    http://stevesouders.com/misc/test-postmessage.php\n\nvar inherits = require('inherits')\n  , JSON3 = require('json3')\n  , EventEmitter = require('events').EventEmitter\n  , version = require('../version')\n  , urlUtils = require('../utils/url')\n  , iframeUtils = require('../utils/iframe')\n  , eventUtils = require('../utils/event')\n  , random = require('../utils/random')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:transport:iframe');\n}\n\nfunction IframeTransport(transport, transUrl, baseUrl) {\n  if (!IframeTransport.enabled()) {\n    throw new Error('Transport created when disabled');\n  }\n  EventEmitter.call(this);\n\n  var self = this;\n  this.origin = urlUtils.getOrigin(baseUrl);\n  this.baseUrl = baseUrl;\n  this.transUrl = transUrl;\n  this.transport = transport;\n  this.windowId = random.string(8);\n\n  var iframeUrl = urlUtils.addPath(baseUrl, '/iframe.html') + '#' + this.windowId;\n  debug(transport, transUrl, iframeUrl);\n\n  this.iframeObj = iframeUtils.createIframe(iframeUrl, function(r) {\n    debug('err callback');\n    self.emit('close', 1006, 'Unable to load an iframe (' + r + ')');\n    self.close();\n  });\n\n  this.onmessageCallback = this._message.bind(this);\n  eventUtils.attachEvent('message', this.onmessageCallback);\n}\n\ninherits(IframeTransport, EventEmitter);\n\nIframeTransport.prototype.close = function() {\n  debug('close');\n  this.removeAllListeners();\n  if (this.iframeObj) {\n    eventUtils.detachEvent('message', this.onmessageCallback);\n    try {\n      // When the iframe is not loaded, IE raises an exception\n      // on 'contentWindow'.\n      this.postMessage('c');\n    } catch (x) {\n      // intentionally empty\n    }\n    this.iframeObj.cleanup();\n    this.iframeObj = null;\n    this.onmessageCallback = this.iframeObj = null;\n  }\n};\n\nIframeTransport.prototype._message = function(e) {\n  debug('message', e.data);\n  if (!urlUtils.isOriginEqual(e.origin, this.origin)) {\n    debug('not same origin', e.origin, this.origin);\n    return;\n  }\n\n  var iframeMessage;\n  try {\n    iframeMessage = JSON3.parse(e.data);\n  } catch (ignored) {\n    debug('bad json', e.data);\n    return;\n  }\n\n  if (iframeMessage.windowId !== this.windowId) {\n    debug('mismatched window id', iframeMessage.windowId, this.windowId);\n    return;\n  }\n\n  switch (iframeMessage.type) {\n  case 's':\n    this.iframeObj.loaded();\n    // window global dependency\n    this.postMessage('s', JSON3.stringify([\n      version\n    , this.transport\n    , this.transUrl\n    , this.baseUrl\n    ]));\n    break;\n  case 't':\n    this.emit('message', iframeMessage.data);\n    break;\n  case 'c':\n    var cdata;\n    try {\n      cdata = JSON3.parse(iframeMessage.data);\n    } catch (ignored) {\n      debug('bad json', iframeMessage.data);\n      return;\n    }\n    this.emit('close', cdata[0], cdata[1]);\n    this.close();\n    break;\n  }\n};\n\nIframeTransport.prototype.postMessage = function(type, data) {\n  debug('postMessage', type, data);\n  this.iframeObj.post(JSON3.stringify({\n    windowId: this.windowId\n  , type: type\n  , data: data || ''\n  }), this.origin);\n};\n\nIframeTransport.prototype.send = function(message) {\n  debug('send', message);\n  this.postMessage('m', message);\n};\n\nIframeTransport.enabled = function() {\n  return iframeUtils.iframeEnabled;\n};\n\nIframeTransport.transportName = 'iframe';\nIframeTransport.roundTrips = 2;\n\nmodule.exports = IframeTransport;\n"]},"metadata":{},"sourceType":"script"}