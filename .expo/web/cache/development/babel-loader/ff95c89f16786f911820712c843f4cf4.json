{"ast":null,"code":"'use strict';\n\nvar EventEmitter = require('events').EventEmitter,\n    inherits = require('inherits'),\n    urlUtils = require(\"./utils/url\"),\n    XDR = require(\"./transport/sender/xdr\"),\n    XHRCors = require(\"./transport/sender/xhr-cors\"),\n    XHRLocal = require(\"./transport/sender/xhr-local\"),\n    XHRFake = require(\"./transport/sender/xhr-fake\"),\n    InfoIframe = require(\"./info-iframe\"),\n    InfoAjax = require(\"./info-ajax\");\n\nvar debug = function debug() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:info-receiver');\n}\n\nfunction InfoReceiver(baseUrl, urlInfo) {\n  debug(baseUrl);\n  var self = this;\n  EventEmitter.call(this);\n  setTimeout(function () {\n    self.doXhr(baseUrl, urlInfo);\n  }, 0);\n}\n\ninherits(InfoReceiver, EventEmitter);\n\nInfoReceiver._getReceiver = function (baseUrl, url, urlInfo) {\n  if (urlInfo.sameOrigin) {\n    return new InfoAjax(url, XHRLocal);\n  }\n\n  if (XHRCors.enabled) {\n    return new InfoAjax(url, XHRCors);\n  }\n\n  if (XDR.enabled && urlInfo.sameScheme) {\n    return new InfoAjax(url, XDR);\n  }\n\n  if (InfoIframe.enabled()) {\n    return new InfoIframe(baseUrl, url);\n  }\n\n  return new InfoAjax(url, XHRFake);\n};\n\nInfoReceiver.prototype.doXhr = function (baseUrl, urlInfo) {\n  var self = this,\n      url = urlUtils.addPath(baseUrl, '/info');\n  debug('doXhr', url);\n  this.xo = InfoReceiver._getReceiver(baseUrl, url, urlInfo);\n  this.timeoutRef = setTimeout(function () {\n    debug('timeout');\n\n    self._cleanup(false);\n\n    self.emit('finish');\n  }, InfoReceiver.timeout);\n  this.xo.once('finish', function (info, rtt) {\n    debug('finish', info, rtt);\n\n    self._cleanup(true);\n\n    self.emit('finish', info, rtt);\n  });\n};\n\nInfoReceiver.prototype._cleanup = function (wasClean) {\n  debug('_cleanup');\n  clearTimeout(this.timeoutRef);\n  this.timeoutRef = null;\n\n  if (!wasClean && this.xo) {\n    this.xo.close();\n  }\n\n  this.xo = null;\n};\n\nInfoReceiver.prototype.close = function () {\n  debug('close');\n  this.removeAllListeners();\n\n  this._cleanup(false);\n};\n\nInfoReceiver.timeout = 8000;\nmodule.exports = InfoReceiver;","map":{"version":3,"sources":["C:/Users/Thivagar/AppData/Roaming/npm/node_modules/expo-cli/node_modules/sockjs-client/lib/info-receiver.js"],"names":["EventEmitter","require","inherits","urlUtils","XDR","XHRCors","XHRLocal","XHRFake","InfoIframe","InfoAjax","debug","process","env","NODE_ENV","InfoReceiver","baseUrl","urlInfo","self","call","setTimeout","doXhr","_getReceiver","url","sameOrigin","enabled","sameScheme","prototype","addPath","xo","timeoutRef","_cleanup","emit","timeout","once","info","rtt","wasClean","clearTimeout","close","removeAllListeners","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,YAAY,GAAGC,OAAO,CAAC,QAAD,CAAP,CAAkBD,YAArC;AAAA,IACIE,QAAQ,GAAGD,OAAO,CAAC,UAAD,CADtB;AAAA,IAEIE,QAAQ,GAAGF,OAAO,eAFtB;AAAA,IAGIG,GAAG,GAAGH,OAAO,0BAHjB;AAAA,IAIII,OAAO,GAAGJ,OAAO,+BAJrB;AAAA,IAKIK,QAAQ,GAAGL,OAAO,gCALtB;AAAA,IAMIM,OAAO,GAAGN,OAAO,+BANrB;AAAA,IAOIO,UAAU,GAAGP,OAAO,iBAPxB;AAAA,IAQIQ,QAAQ,GAAGR,OAAO,eARtB;;AAWA,IAAIS,KAAK,GAAG,iBAAW,CAAE,CAAzB;;AACA,IAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AACzCH,EAAAA,KAAK,GAAGT,OAAO,CAAC,OAAD,CAAP,CAAiB,6BAAjB,CAAR;AACD;;AAED,SAASa,YAAT,CAAsBC,OAAtB,EAA+BC,OAA/B,EAAwC;AACtCN,EAAAA,KAAK,CAACK,OAAD,CAAL;AACA,MAAIE,IAAI,GAAG,IAAX;AACAjB,EAAAA,YAAY,CAACkB,IAAb,CAAkB,IAAlB;AAEAC,EAAAA,UAAU,CAAC,YAAW;AACpBF,IAAAA,IAAI,CAACG,KAAL,CAAWL,OAAX,EAAoBC,OAApB;AACD,GAFS,EAEP,CAFO,CAAV;AAGD;;AAEDd,QAAQ,CAACY,YAAD,EAAed,YAAf,CAAR;;AAIAc,YAAY,CAACO,YAAb,GAA4B,UAASN,OAAT,EAAkBO,GAAlB,EAAuBN,OAAvB,EAAgC;AAE1D,MAAIA,OAAO,CAACO,UAAZ,EAAwB;AACtB,WAAO,IAAId,QAAJ,CAAaa,GAAb,EAAkBhB,QAAlB,CAAP;AACD;;AACD,MAAID,OAAO,CAACmB,OAAZ,EAAqB;AACnB,WAAO,IAAIf,QAAJ,CAAaa,GAAb,EAAkBjB,OAAlB,CAAP;AACD;;AACD,MAAID,GAAG,CAACoB,OAAJ,IAAeR,OAAO,CAACS,UAA3B,EAAuC;AACrC,WAAO,IAAIhB,QAAJ,CAAaa,GAAb,EAAkBlB,GAAlB,CAAP;AACD;;AACD,MAAII,UAAU,CAACgB,OAAX,EAAJ,EAA0B;AACxB,WAAO,IAAIhB,UAAJ,CAAeO,OAAf,EAAwBO,GAAxB,CAAP;AACD;;AACD,SAAO,IAAIb,QAAJ,CAAaa,GAAb,EAAkBf,OAAlB,CAAP;AACD,CAfD;;AAiBAO,YAAY,CAACY,SAAb,CAAuBN,KAAvB,GAA+B,UAASL,OAAT,EAAkBC,OAAlB,EAA2B;AACxD,MAAIC,IAAI,GAAG,IAAX;AAAA,MACIK,GAAG,GAAGnB,QAAQ,CAACwB,OAAT,CAAiBZ,OAAjB,EAA0B,OAA1B,CADV;AAGAL,EAAAA,KAAK,CAAC,OAAD,EAAUY,GAAV,CAAL;AAEA,OAAKM,EAAL,GAAUd,YAAY,CAACO,YAAb,CAA0BN,OAA1B,EAAmCO,GAAnC,EAAwCN,OAAxC,CAAV;AAEA,OAAKa,UAAL,GAAkBV,UAAU,CAAC,YAAW;AACtCT,IAAAA,KAAK,CAAC,SAAD,CAAL;;AACAO,IAAAA,IAAI,CAACa,QAAL,CAAc,KAAd;;AACAb,IAAAA,IAAI,CAACc,IAAL,CAAU,QAAV;AACD,GAJ2B,EAIzBjB,YAAY,CAACkB,OAJY,CAA5B;AAMA,OAAKJ,EAAL,CAAQK,IAAR,CAAa,QAAb,EAAuB,UAASC,IAAT,EAAeC,GAAf,EAAoB;AACzCzB,IAAAA,KAAK,CAAC,QAAD,EAAWwB,IAAX,EAAiBC,GAAjB,CAAL;;AACAlB,IAAAA,IAAI,CAACa,QAAL,CAAc,IAAd;;AACAb,IAAAA,IAAI,CAACc,IAAL,CAAU,QAAV,EAAoBG,IAApB,EAA0BC,GAA1B;AACD,GAJD;AAKD,CAnBD;;AAqBArB,YAAY,CAACY,SAAb,CAAuBI,QAAvB,GAAkC,UAASM,QAAT,EAAmB;AACnD1B,EAAAA,KAAK,CAAC,UAAD,CAAL;AACA2B,EAAAA,YAAY,CAAC,KAAKR,UAAN,CAAZ;AACA,OAAKA,UAAL,GAAkB,IAAlB;;AACA,MAAI,CAACO,QAAD,IAAa,KAAKR,EAAtB,EAA0B;AACxB,SAAKA,EAAL,CAAQU,KAAR;AACD;;AACD,OAAKV,EAAL,GAAU,IAAV;AACD,CARD;;AAUAd,YAAY,CAACY,SAAb,CAAuBY,KAAvB,GAA+B,YAAW;AACxC5B,EAAAA,KAAK,CAAC,OAAD,CAAL;AACA,OAAK6B,kBAAL;;AACA,OAAKT,QAAL,CAAc,KAAd;AACD,CAJD;;AAMAhB,YAAY,CAACkB,OAAb,GAAuB,IAAvB;AAEAQ,MAAM,CAACC,OAAP,GAAiB3B,YAAjB","sourcesContent":["'use strict';\n\nvar EventEmitter = require('events').EventEmitter\n  , inherits = require('inherits')\n  , urlUtils = require('./utils/url')\n  , XDR = require('./transport/sender/xdr')\n  , XHRCors = require('./transport/sender/xhr-cors')\n  , XHRLocal = require('./transport/sender/xhr-local')\n  , XHRFake = require('./transport/sender/xhr-fake')\n  , InfoIframe = require('./info-iframe')\n  , InfoAjax = require('./info-ajax')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:info-receiver');\n}\n\nfunction InfoReceiver(baseUrl, urlInfo) {\n  debug(baseUrl);\n  var self = this;\n  EventEmitter.call(this);\n\n  setTimeout(function() {\n    self.doXhr(baseUrl, urlInfo);\n  }, 0);\n}\n\ninherits(InfoReceiver, EventEmitter);\n\n// TODO this is currently ignoring the list of available transports and the whitelist\n\nInfoReceiver._getReceiver = function(baseUrl, url, urlInfo) {\n  // determine method of CORS support (if needed)\n  if (urlInfo.sameOrigin) {\n    return new InfoAjax(url, XHRLocal);\n  }\n  if (XHRCors.enabled) {\n    return new InfoAjax(url, XHRCors);\n  }\n  if (XDR.enabled && urlInfo.sameScheme) {\n    return new InfoAjax(url, XDR);\n  }\n  if (InfoIframe.enabled()) {\n    return new InfoIframe(baseUrl, url);\n  }\n  return new InfoAjax(url, XHRFake);\n};\n\nInfoReceiver.prototype.doXhr = function(baseUrl, urlInfo) {\n  var self = this\n    , url = urlUtils.addPath(baseUrl, '/info')\n    ;\n  debug('doXhr', url);\n\n  this.xo = InfoReceiver._getReceiver(baseUrl, url, urlInfo);\n\n  this.timeoutRef = setTimeout(function() {\n    debug('timeout');\n    self._cleanup(false);\n    self.emit('finish');\n  }, InfoReceiver.timeout);\n\n  this.xo.once('finish', function(info, rtt) {\n    debug('finish', info, rtt);\n    self._cleanup(true);\n    self.emit('finish', info, rtt);\n  });\n};\n\nInfoReceiver.prototype._cleanup = function(wasClean) {\n  debug('_cleanup');\n  clearTimeout(this.timeoutRef);\n  this.timeoutRef = null;\n  if (!wasClean && this.xo) {\n    this.xo.close();\n  }\n  this.xo = null;\n};\n\nInfoReceiver.prototype.close = function() {\n  debug('close');\n  this.removeAllListeners();\n  this._cleanup(false);\n};\n\nInfoReceiver.timeout = 8000;\n\nmodule.exports = InfoReceiver;\n"]},"metadata":{},"sourceType":"script"}