{"ast":null,"code":"'use strict';\n\nvar inherits = require('inherits'),\n    iframeUtils = require(\"../../utils/iframe\"),\n    urlUtils = require(\"../../utils/url\"),\n    EventEmitter = require('events').EventEmitter,\n    random = require(\"../../utils/random\");\n\nvar debug = function debug() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:receiver:htmlfile');\n}\n\nfunction HtmlfileReceiver(url) {\n  debug(url);\n  EventEmitter.call(this);\n  var self = this;\n  iframeUtils.polluteGlobalNamespace();\n  this.id = 'a' + random.string(6);\n  url = urlUtils.addQuery(url, 'c=' + decodeURIComponent(iframeUtils.WPrefix + '.' + this.id));\n  debug('using htmlfile', HtmlfileReceiver.htmlfileEnabled);\n  var constructFunc = HtmlfileReceiver.htmlfileEnabled ? iframeUtils.createHtmlfile : iframeUtils.createIframe;\n  global[iframeUtils.WPrefix][this.id] = {\n    start: function start() {\n      debug('start');\n      self.iframeObj.loaded();\n    },\n    message: function message(data) {\n      debug('message', data);\n      self.emit('message', data);\n    },\n    stop: function stop() {\n      debug('stop');\n\n      self._cleanup();\n\n      self._close('network');\n    }\n  };\n  this.iframeObj = constructFunc(url, function () {\n    debug('callback');\n\n    self._cleanup();\n\n    self._close('permanent');\n  });\n}\n\ninherits(HtmlfileReceiver, EventEmitter);\n\nHtmlfileReceiver.prototype.abort = function () {\n  debug('abort');\n\n  this._cleanup();\n\n  this._close('user');\n};\n\nHtmlfileReceiver.prototype._cleanup = function () {\n  debug('_cleanup');\n\n  if (this.iframeObj) {\n    this.iframeObj.cleanup();\n    this.iframeObj = null;\n  }\n\n  delete global[iframeUtils.WPrefix][this.id];\n};\n\nHtmlfileReceiver.prototype._close = function (reason) {\n  debug('_close', reason);\n  this.emit('close', null, reason);\n  this.removeAllListeners();\n};\n\nHtmlfileReceiver.htmlfileEnabled = false;\nvar axo = ['Active'].concat('Object').join('X');\n\nif (axo in global) {\n  try {\n    HtmlfileReceiver.htmlfileEnabled = !!new global[axo]('htmlfile');\n  } catch (x) {}\n}\n\nHtmlfileReceiver.enabled = HtmlfileReceiver.htmlfileEnabled || iframeUtils.iframeEnabled;\nmodule.exports = HtmlfileReceiver;","map":{"version":3,"sources":["C:/Users/Thivagar/AppData/Roaming/npm/node_modules/expo-cli/node_modules/sockjs-client/lib/transport/receiver/htmlfile.js"],"names":["inherits","require","iframeUtils","urlUtils","EventEmitter","random","debug","process","env","NODE_ENV","HtmlfileReceiver","url","call","self","polluteGlobalNamespace","id","string","addQuery","decodeURIComponent","WPrefix","htmlfileEnabled","constructFunc","createHtmlfile","createIframe","global","start","iframeObj","loaded","message","data","emit","stop","_cleanup","_close","prototype","abort","cleanup","reason","removeAllListeners","axo","concat","join","x","enabled","iframeEnabled","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar inherits = require('inherits')\n  , iframeUtils = require('../../utils/iframe')\n  , urlUtils = require('../../utils/url')\n  , EventEmitter = require('events').EventEmitter\n  , random = require('../../utils/random')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:receiver:htmlfile');\n}\n\nfunction HtmlfileReceiver(url) {\n  debug(url);\n  EventEmitter.call(this);\n  var self = this;\n  iframeUtils.polluteGlobalNamespace();\n\n  this.id = 'a' + random.string(6);\n  url = urlUtils.addQuery(url, 'c=' + decodeURIComponent(iframeUtils.WPrefix + '.' + this.id));\n\n  debug('using htmlfile', HtmlfileReceiver.htmlfileEnabled);\n  var constructFunc = HtmlfileReceiver.htmlfileEnabled ?\n      iframeUtils.createHtmlfile : iframeUtils.createIframe;\n\n  global[iframeUtils.WPrefix][this.id] = {\n    start: function() {\n      debug('start');\n      self.iframeObj.loaded();\n    }\n  , message: function(data) {\n      debug('message', data);\n      self.emit('message', data);\n    }\n  , stop: function() {\n      debug('stop');\n      self._cleanup();\n      self._close('network');\n    }\n  };\n  this.iframeObj = constructFunc(url, function() {\n    debug('callback');\n    self._cleanup();\n    self._close('permanent');\n  });\n}\n\ninherits(HtmlfileReceiver, EventEmitter);\n\nHtmlfileReceiver.prototype.abort = function() {\n  debug('abort');\n  this._cleanup();\n  this._close('user');\n};\n\nHtmlfileReceiver.prototype._cleanup = function() {\n  debug('_cleanup');\n  if (this.iframeObj) {\n    this.iframeObj.cleanup();\n    this.iframeObj = null;\n  }\n  delete global[iframeUtils.WPrefix][this.id];\n};\n\nHtmlfileReceiver.prototype._close = function(reason) {\n  debug('_close', reason);\n  this.emit('close', null, reason);\n  this.removeAllListeners();\n};\n\nHtmlfileReceiver.htmlfileEnabled = false;\n\n// obfuscate to avoid firewalls\nvar axo = ['Active'].concat('Object').join('X');\nif (axo in global) {\n  try {\n    HtmlfileReceiver.htmlfileEnabled = !!new global[axo]('htmlfile');\n  } catch (x) {\n    // intentionally empty\n  }\n}\n\nHtmlfileReceiver.enabled = HtmlfileReceiver.htmlfileEnabled || iframeUtils.iframeEnabled;\n\nmodule.exports = HtmlfileReceiver;\n"]},"metadata":{},"sourceType":"script"}