{"ast":null,"code":"'use strict';\n\nvar utils = require(\"../../utils/iframe\"),\n    random = require(\"../../utils/random\"),\n    browser = require(\"../../utils/browser\"),\n    urlUtils = require(\"../../utils/url\"),\n    inherits = require('inherits'),\n    EventEmitter = require('events').EventEmitter;\n\nvar debug = function debug() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:receiver:jsonp');\n}\n\nfunction JsonpReceiver(url) {\n  debug(url);\n  var self = this;\n  EventEmitter.call(this);\n  utils.polluteGlobalNamespace();\n  this.id = 'a' + random.string(6);\n  var urlWithId = urlUtils.addQuery(url, 'c=' + encodeURIComponent(utils.WPrefix + '.' + this.id));\n  global[utils.WPrefix][this.id] = this._callback.bind(this);\n\n  this._createScript(urlWithId);\n\n  this.timeoutId = setTimeout(function () {\n    debug('timeout');\n\n    self._abort(new Error('JSONP script loaded abnormally (timeout)'));\n  }, JsonpReceiver.timeout);\n}\n\ninherits(JsonpReceiver, EventEmitter);\n\nJsonpReceiver.prototype.abort = function () {\n  debug('abort');\n\n  if (global[utils.WPrefix][this.id]) {\n    var err = new Error('JSONP user aborted read');\n    err.code = 1000;\n\n    this._abort(err);\n  }\n};\n\nJsonpReceiver.timeout = 35000;\nJsonpReceiver.scriptErrorTimeout = 1000;\n\nJsonpReceiver.prototype._callback = function (data) {\n  debug('_callback', data);\n\n  this._cleanup();\n\n  if (this.aborting) {\n    return;\n  }\n\n  if (data) {\n    debug('message', data);\n    this.emit('message', data);\n  }\n\n  this.emit('close', null, 'network');\n  this.removeAllListeners();\n};\n\nJsonpReceiver.prototype._abort = function (err) {\n  debug('_abort', err);\n\n  this._cleanup();\n\n  this.aborting = true;\n  this.emit('close', err.code, err.message);\n  this.removeAllListeners();\n};\n\nJsonpReceiver.prototype._cleanup = function () {\n  debug('_cleanup');\n  clearTimeout(this.timeoutId);\n\n  if (this.script2) {\n    this.script2.parentNode.removeChild(this.script2);\n    this.script2 = null;\n  }\n\n  if (this.script) {\n    var script = this.script;\n    script.parentNode.removeChild(script);\n    script.onreadystatechange = script.onerror = script.onload = script.onclick = null;\n    this.script = null;\n  }\n\n  delete global[utils.WPrefix][this.id];\n};\n\nJsonpReceiver.prototype._scriptError = function () {\n  debug('_scriptError');\n  var self = this;\n\n  if (this.errorTimer) {\n    return;\n  }\n\n  this.errorTimer = setTimeout(function () {\n    if (!self.loadedOkay) {\n      self._abort(new Error('JSONP script loaded abnormally (onerror)'));\n    }\n  }, JsonpReceiver.scriptErrorTimeout);\n};\n\nJsonpReceiver.prototype._createScript = function (url) {\n  debug('_createScript', url);\n  var self = this;\n  var script = this.script = global.document.createElement('script');\n  var script2;\n  script.id = 'a' + random.string(8);\n  script.src = url;\n  script.type = 'text/javascript';\n  script.charset = 'UTF-8';\n  script.onerror = this._scriptError.bind(this);\n\n  script.onload = function () {\n    debug('onload');\n\n    self._abort(new Error('JSONP script loaded abnormally (onload)'));\n  };\n\n  script.onreadystatechange = function () {\n    debug('onreadystatechange', script.readyState);\n\n    if (/loaded|closed/.test(script.readyState)) {\n      if (script && script.htmlFor && script.onclick) {\n        self.loadedOkay = true;\n\n        try {\n          script.onclick();\n        } catch (x) {}\n      }\n\n      if (script) {\n        self._abort(new Error('JSONP script loaded abnormally (onreadystatechange)'));\n      }\n    }\n  };\n\n  if (typeof script.async === 'undefined' && global.document.attachEvent) {\n    if (!browser.isOpera()) {\n      try {\n        script.htmlFor = script.id;\n        script.event = 'onclick';\n      } catch (x) {}\n\n      script.async = true;\n    } else {\n      script2 = this.script2 = global.document.createElement('script');\n      script2.text = \"try{var a = document.getElementById('\" + script.id + \"'); if(a)a.onerror();}catch(x){};\";\n      script.async = script2.async = false;\n    }\n  }\n\n  if (typeof script.async !== 'undefined') {\n    script.async = true;\n  }\n\n  var head = global.document.getElementsByTagName('head')[0];\n  head.insertBefore(script, head.firstChild);\n\n  if (script2) {\n    head.insertBefore(script2, head.firstChild);\n  }\n};\n\nmodule.exports = JsonpReceiver;","map":{"version":3,"sources":["C:/Users/Thivagar/AppData/Roaming/npm/node_modules/expo-cli/node_modules/sockjs-client/lib/transport/receiver/jsonp.js"],"names":["utils","require","random","browser","urlUtils","inherits","EventEmitter","debug","process","env","NODE_ENV","JsonpReceiver","url","self","call","polluteGlobalNamespace","id","string","urlWithId","addQuery","encodeURIComponent","WPrefix","global","_callback","bind","_createScript","timeoutId","setTimeout","_abort","Error","timeout","prototype","abort","err","code","scriptErrorTimeout","data","_cleanup","aborting","emit","removeAllListeners","message","clearTimeout","script2","parentNode","removeChild","script","onreadystatechange","onerror","onload","onclick","_scriptError","errorTimer","loadedOkay","document","createElement","src","type","charset","readyState","test","htmlFor","x","async","attachEvent","isOpera","event","text","head","getElementsByTagName","insertBefore","firstChild","module","exports"],"mappings":"AAAA;;AAEA,IAAIA,KAAK,GAAGC,OAAO,sBAAnB;AAAA,IACIC,MAAM,GAAGD,OAAO,sBADpB;AAAA,IAEIE,OAAO,GAAGF,OAAO,uBAFrB;AAAA,IAGIG,QAAQ,GAAGH,OAAO,mBAHtB;AAAA,IAIII,QAAQ,GAAGJ,OAAO,CAAC,UAAD,CAJtB;AAAA,IAKIK,YAAY,GAAGL,OAAO,CAAC,QAAD,CAAP,CAAkBK,YALrC;;AAQA,IAAIC,KAAK,GAAG,iBAAW,CAAE,CAAzB;;AACA,IAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;AACzCH,EAAAA,KAAK,GAAGN,OAAO,CAAC,OAAD,CAAP,CAAiB,8BAAjB,CAAR;AACD;;AAED,SAASU,aAAT,CAAuBC,GAAvB,EAA4B;AAC1BL,EAAAA,KAAK,CAACK,GAAD,CAAL;AACA,MAAIC,IAAI,GAAG,IAAX;AACAP,EAAAA,YAAY,CAACQ,IAAb,CAAkB,IAAlB;AAEAd,EAAAA,KAAK,CAACe,sBAAN;AAEA,OAAKC,EAAL,GAAU,MAAMd,MAAM,CAACe,MAAP,CAAc,CAAd,CAAhB;AACA,MAAIC,SAAS,GAAGd,QAAQ,CAACe,QAAT,CAAkBP,GAAlB,EAAuB,OAAOQ,kBAAkB,CAACpB,KAAK,CAACqB,OAAN,GAAgB,GAAhB,GAAsB,KAAKL,EAA5B,CAAhD,CAAhB;AAEAM,EAAAA,MAAM,CAACtB,KAAK,CAACqB,OAAP,CAAN,CAAsB,KAAKL,EAA3B,IAAiC,KAAKO,SAAL,CAAeC,IAAf,CAAoB,IAApB,CAAjC;;AACA,OAAKC,aAAL,CAAmBP,SAAnB;;AAGA,OAAKQ,SAAL,GAAiBC,UAAU,CAAC,YAAW;AACrCpB,IAAAA,KAAK,CAAC,SAAD,CAAL;;AACAM,IAAAA,IAAI,CAACe,MAAL,CAAY,IAAIC,KAAJ,CAAU,0CAAV,CAAZ;AACD,GAH0B,EAGxBlB,aAAa,CAACmB,OAHU,CAA3B;AAID;;AAEDzB,QAAQ,CAACM,aAAD,EAAgBL,YAAhB,CAAR;;AAEAK,aAAa,CAACoB,SAAd,CAAwBC,KAAxB,GAAgC,YAAW;AACzCzB,EAAAA,KAAK,CAAC,OAAD,CAAL;;AACA,MAAIe,MAAM,CAACtB,KAAK,CAACqB,OAAP,CAAN,CAAsB,KAAKL,EAA3B,CAAJ,EAAoC;AAClC,QAAIiB,GAAG,GAAG,IAAIJ,KAAJ,CAAU,yBAAV,CAAV;AACAI,IAAAA,GAAG,CAACC,IAAJ,GAAW,IAAX;;AACA,SAAKN,MAAL,CAAYK,GAAZ;AACD;AACF,CAPD;;AASAtB,aAAa,CAACmB,OAAd,GAAwB,KAAxB;AACAnB,aAAa,CAACwB,kBAAd,GAAmC,IAAnC;;AAEAxB,aAAa,CAACoB,SAAd,CAAwBR,SAAxB,GAAoC,UAASa,IAAT,EAAe;AACjD7B,EAAAA,KAAK,CAAC,WAAD,EAAc6B,IAAd,CAAL;;AACA,OAAKC,QAAL;;AAEA,MAAI,KAAKC,QAAT,EAAmB;AACjB;AACD;;AAED,MAAIF,IAAJ,EAAU;AACR7B,IAAAA,KAAK,CAAC,SAAD,EAAY6B,IAAZ,CAAL;AACA,SAAKG,IAAL,CAAU,SAAV,EAAqBH,IAArB;AACD;;AACD,OAAKG,IAAL,CAAU,OAAV,EAAmB,IAAnB,EAAyB,SAAzB;AACA,OAAKC,kBAAL;AACD,CAdD;;AAgBA7B,aAAa,CAACoB,SAAd,CAAwBH,MAAxB,GAAiC,UAASK,GAAT,EAAc;AAC7C1B,EAAAA,KAAK,CAAC,QAAD,EAAW0B,GAAX,CAAL;;AACA,OAAKI,QAAL;;AACA,OAAKC,QAAL,GAAgB,IAAhB;AACA,OAAKC,IAAL,CAAU,OAAV,EAAmBN,GAAG,CAACC,IAAvB,EAA6BD,GAAG,CAACQ,OAAjC;AACA,OAAKD,kBAAL;AACD,CAND;;AAQA7B,aAAa,CAACoB,SAAd,CAAwBM,QAAxB,GAAmC,YAAW;AAC5C9B,EAAAA,KAAK,CAAC,UAAD,CAAL;AACAmC,EAAAA,YAAY,CAAC,KAAKhB,SAAN,CAAZ;;AACA,MAAI,KAAKiB,OAAT,EAAkB;AAChB,SAAKA,OAAL,CAAaC,UAAb,CAAwBC,WAAxB,CAAoC,KAAKF,OAAzC;AACA,SAAKA,OAAL,GAAe,IAAf;AACD;;AACD,MAAI,KAAKG,MAAT,EAAiB;AACf,QAAIA,MAAM,GAAG,KAAKA,MAAlB;AAGAA,IAAAA,MAAM,CAACF,UAAP,CAAkBC,WAAlB,CAA8BC,MAA9B;AACAA,IAAAA,MAAM,CAACC,kBAAP,GAA4BD,MAAM,CAACE,OAAP,GACxBF,MAAM,CAACG,MAAP,GAAgBH,MAAM,CAACI,OAAP,GAAiB,IADrC;AAEA,SAAKJ,MAAL,GAAc,IAAd;AACD;;AACD,SAAOxB,MAAM,CAACtB,KAAK,CAACqB,OAAP,CAAN,CAAsB,KAAKL,EAA3B,CAAP;AACD,CAjBD;;AAmBAL,aAAa,CAACoB,SAAd,CAAwBoB,YAAxB,GAAuC,YAAW;AAChD5C,EAAAA,KAAK,CAAC,cAAD,CAAL;AACA,MAAIM,IAAI,GAAG,IAAX;;AACA,MAAI,KAAKuC,UAAT,EAAqB;AACnB;AACD;;AAED,OAAKA,UAAL,GAAkBzB,UAAU,CAAC,YAAW;AACtC,QAAI,CAACd,IAAI,CAACwC,UAAV,EAAsB;AACpBxC,MAAAA,IAAI,CAACe,MAAL,CAAY,IAAIC,KAAJ,CAAU,0CAAV,CAAZ;AACD;AACF,GAJ2B,EAIzBlB,aAAa,CAACwB,kBAJW,CAA5B;AAKD,CAZD;;AAcAxB,aAAa,CAACoB,SAAd,CAAwBN,aAAxB,GAAwC,UAASb,GAAT,EAAc;AACpDL,EAAAA,KAAK,CAAC,eAAD,EAAkBK,GAAlB,CAAL;AACA,MAAIC,IAAI,GAAG,IAAX;AACA,MAAIiC,MAAM,GAAG,KAAKA,MAAL,GAAcxB,MAAM,CAACgC,QAAP,CAAgBC,aAAhB,CAA8B,QAA9B,CAA3B;AACA,MAAIZ,OAAJ;AAEAG,EAAAA,MAAM,CAAC9B,EAAP,GAAY,MAAMd,MAAM,CAACe,MAAP,CAAc,CAAd,CAAlB;AACA6B,EAAAA,MAAM,CAACU,GAAP,GAAa5C,GAAb;AACAkC,EAAAA,MAAM,CAACW,IAAP,GAAc,iBAAd;AACAX,EAAAA,MAAM,CAACY,OAAP,GAAiB,OAAjB;AACAZ,EAAAA,MAAM,CAACE,OAAP,GAAiB,KAAKG,YAAL,CAAkB3B,IAAlB,CAAuB,IAAvB,CAAjB;;AACAsB,EAAAA,MAAM,CAACG,MAAP,GAAgB,YAAW;AACzB1C,IAAAA,KAAK,CAAC,QAAD,CAAL;;AACAM,IAAAA,IAAI,CAACe,MAAL,CAAY,IAAIC,KAAJ,CAAU,yCAAV,CAAZ;AACD,GAHD;;AAOAiB,EAAAA,MAAM,CAACC,kBAAP,GAA4B,YAAW;AACrCxC,IAAAA,KAAK,CAAC,oBAAD,EAAuBuC,MAAM,CAACa,UAA9B,CAAL;;AACA,QAAI,gBAAgBC,IAAhB,CAAqBd,MAAM,CAACa,UAA5B,CAAJ,EAA6C;AAC3C,UAAIb,MAAM,IAAIA,MAAM,CAACe,OAAjB,IAA4Bf,MAAM,CAACI,OAAvC,EAAgD;AAC9CrC,QAAAA,IAAI,CAACwC,UAAL,GAAkB,IAAlB;;AACA,YAAI;AAEFP,UAAAA,MAAM,CAACI,OAAP;AACD,SAHD,CAGE,OAAOY,CAAP,EAAU,CAEX;AACF;;AACD,UAAIhB,MAAJ,EAAY;AACVjC,QAAAA,IAAI,CAACe,MAAL,CAAY,IAAIC,KAAJ,CAAU,qDAAV,CAAZ;AACD;AACF;AACF,GAhBD;;AA2BA,MAAI,OAAOiB,MAAM,CAACiB,KAAd,KAAwB,WAAxB,IAAuCzC,MAAM,CAACgC,QAAP,CAAgBU,WAA3D,EAAwE;AAItE,QAAI,CAAC7D,OAAO,CAAC8D,OAAR,EAAL,EAAwB;AAEtB,UAAI;AACFnB,QAAAA,MAAM,CAACe,OAAP,GAAiBf,MAAM,CAAC9B,EAAxB;AACA8B,QAAAA,MAAM,CAACoB,KAAP,GAAe,SAAf;AACD,OAHD,CAGE,OAAOJ,CAAP,EAAU,CAEX;;AACDhB,MAAAA,MAAM,CAACiB,KAAP,GAAe,IAAf;AACD,KATD,MASO;AAELpB,MAAAA,OAAO,GAAG,KAAKA,OAAL,GAAerB,MAAM,CAACgC,QAAP,CAAgBC,aAAhB,CAA8B,QAA9B,CAAzB;AACAZ,MAAAA,OAAO,CAACwB,IAAR,GAAe,0CAA0CrB,MAAM,CAAC9B,EAAjD,GAAsD,mCAArE;AACA8B,MAAAA,MAAM,CAACiB,KAAP,GAAepB,OAAO,CAACoB,KAAR,GAAgB,KAA/B;AACD;AACF;;AACD,MAAI,OAAOjB,MAAM,CAACiB,KAAd,KAAwB,WAA5B,EAAyC;AACvCjB,IAAAA,MAAM,CAACiB,KAAP,GAAe,IAAf;AACD;;AAED,MAAIK,IAAI,GAAG9C,MAAM,CAACgC,QAAP,CAAgBe,oBAAhB,CAAqC,MAArC,EAA6C,CAA7C,CAAX;AACAD,EAAAA,IAAI,CAACE,YAAL,CAAkBxB,MAAlB,EAA0BsB,IAAI,CAACG,UAA/B;;AACA,MAAI5B,OAAJ,EAAa;AACXyB,IAAAA,IAAI,CAACE,YAAL,CAAkB3B,OAAlB,EAA2ByB,IAAI,CAACG,UAAhC;AACD;AACF,CA1ED;;AA4EAC,MAAM,CAACC,OAAP,GAAiB9D,aAAjB","sourcesContent":["'use strict';\n\nvar utils = require('../../utils/iframe')\n  , random = require('../../utils/random')\n  , browser = require('../../utils/browser')\n  , urlUtils = require('../../utils/url')\n  , inherits = require('inherits')\n  , EventEmitter = require('events').EventEmitter\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:receiver:jsonp');\n}\n\nfunction JsonpReceiver(url) {\n  debug(url);\n  var self = this;\n  EventEmitter.call(this);\n\n  utils.polluteGlobalNamespace();\n\n  this.id = 'a' + random.string(6);\n  var urlWithId = urlUtils.addQuery(url, 'c=' + encodeURIComponent(utils.WPrefix + '.' + this.id));\n\n  global[utils.WPrefix][this.id] = this._callback.bind(this);\n  this._createScript(urlWithId);\n\n  // Fallback mostly for Konqueror - stupid timer, 35 seconds shall be plenty.\n  this.timeoutId = setTimeout(function() {\n    debug('timeout');\n    self._abort(new Error('JSONP script loaded abnormally (timeout)'));\n  }, JsonpReceiver.timeout);\n}\n\ninherits(JsonpReceiver, EventEmitter);\n\nJsonpReceiver.prototype.abort = function() {\n  debug('abort');\n  if (global[utils.WPrefix][this.id]) {\n    var err = new Error('JSONP user aborted read');\n    err.code = 1000;\n    this._abort(err);\n  }\n};\n\nJsonpReceiver.timeout = 35000;\nJsonpReceiver.scriptErrorTimeout = 1000;\n\nJsonpReceiver.prototype._callback = function(data) {\n  debug('_callback', data);\n  this._cleanup();\n\n  if (this.aborting) {\n    return;\n  }\n\n  if (data) {\n    debug('message', data);\n    this.emit('message', data);\n  }\n  this.emit('close', null, 'network');\n  this.removeAllListeners();\n};\n\nJsonpReceiver.prototype._abort = function(err) {\n  debug('_abort', err);\n  this._cleanup();\n  this.aborting = true;\n  this.emit('close', err.code, err.message);\n  this.removeAllListeners();\n};\n\nJsonpReceiver.prototype._cleanup = function() {\n  debug('_cleanup');\n  clearTimeout(this.timeoutId);\n  if (this.script2) {\n    this.script2.parentNode.removeChild(this.script2);\n    this.script2 = null;\n  }\n  if (this.script) {\n    var script = this.script;\n    // Unfortunately, you can't really abort script loading of\n    // the script.\n    script.parentNode.removeChild(script);\n    script.onreadystatechange = script.onerror =\n        script.onload = script.onclick = null;\n    this.script = null;\n  }\n  delete global[utils.WPrefix][this.id];\n};\n\nJsonpReceiver.prototype._scriptError = function() {\n  debug('_scriptError');\n  var self = this;\n  if (this.errorTimer) {\n    return;\n  }\n\n  this.errorTimer = setTimeout(function() {\n    if (!self.loadedOkay) {\n      self._abort(new Error('JSONP script loaded abnormally (onerror)'));\n    }\n  }, JsonpReceiver.scriptErrorTimeout);\n};\n\nJsonpReceiver.prototype._createScript = function(url) {\n  debug('_createScript', url);\n  var self = this;\n  var script = this.script = global.document.createElement('script');\n  var script2;  // Opera synchronous load trick.\n\n  script.id = 'a' + random.string(8);\n  script.src = url;\n  script.type = 'text/javascript';\n  script.charset = 'UTF-8';\n  script.onerror = this._scriptError.bind(this);\n  script.onload = function() {\n    debug('onload');\n    self._abort(new Error('JSONP script loaded abnormally (onload)'));\n  };\n\n  // IE9 fires 'error' event after onreadystatechange or before, in random order.\n  // Use loadedOkay to determine if actually errored\n  script.onreadystatechange = function() {\n    debug('onreadystatechange', script.readyState);\n    if (/loaded|closed/.test(script.readyState)) {\n      if (script && script.htmlFor && script.onclick) {\n        self.loadedOkay = true;\n        try {\n          // In IE, actually execute the script.\n          script.onclick();\n        } catch (x) {\n          // intentionally empty\n        }\n      }\n      if (script) {\n        self._abort(new Error('JSONP script loaded abnormally (onreadystatechange)'));\n      }\n    }\n  };\n  // IE: event/htmlFor/onclick trick.\n  // One can't rely on proper order for onreadystatechange. In order to\n  // make sure, set a 'htmlFor' and 'event' properties, so that\n  // script code will be installed as 'onclick' handler for the\n  // script object. Later, onreadystatechange, manually execute this\n  // code. FF and Chrome doesn't work with 'event' and 'htmlFor'\n  // set. For reference see:\n  //   http://jaubourg.net/2010/07/loading-script-as-onclick-handler-of.html\n  // Also, read on that about script ordering:\n  //   http://wiki.whatwg.org/wiki/Dynamic_Script_Execution_Order\n  if (typeof script.async === 'undefined' && global.document.attachEvent) {\n    // According to mozilla docs, in recent browsers script.async defaults\n    // to 'true', so we may use it to detect a good browser:\n    // https://developer.mozilla.org/en/HTML/Element/script\n    if (!browser.isOpera()) {\n      // Naively assume we're in IE\n      try {\n        script.htmlFor = script.id;\n        script.event = 'onclick';\n      } catch (x) {\n        // intentionally empty\n      }\n      script.async = true;\n    } else {\n      // Opera, second sync script hack\n      script2 = this.script2 = global.document.createElement('script');\n      script2.text = \"try{var a = document.getElementById('\" + script.id + \"'); if(a)a.onerror();}catch(x){};\";\n      script.async = script2.async = false;\n    }\n  }\n  if (typeof script.async !== 'undefined') {\n    script.async = true;\n  }\n\n  var head = global.document.getElementsByTagName('head')[0];\n  head.insertBefore(script, head.firstChild);\n  if (script2) {\n    head.insertBefore(script2, head.firstChild);\n  }\n};\n\nmodule.exports = JsonpReceiver;\n"]},"metadata":{},"sourceType":"script"}