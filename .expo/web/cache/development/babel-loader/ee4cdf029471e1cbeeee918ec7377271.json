{"ast":null,"code":"'use strict';\n\nvar eventUtils = require(\"./event\"),\n    JSON3 = require('json3'),\n    browser = require(\"./browser\");\n\nvar debug = function debug() {};\n\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:utils:iframe');\n}\n\nmodule.exports = {\n  WPrefix: '_jp',\n  currentWindowId: null,\n  polluteGlobalNamespace: function polluteGlobalNamespace() {\n    if (!(module.exports.WPrefix in global)) {\n      global[module.exports.WPrefix] = {};\n    }\n  },\n  postMessage: function postMessage(type, data) {\n    if (global.parent !== global) {\n      global.parent.postMessage(JSON3.stringify({\n        windowId: module.exports.currentWindowId,\n        type: type,\n        data: data || ''\n      }), '*');\n    } else {\n      debug('Cannot postMessage, no parent window.', type, data);\n    }\n  },\n  createIframe: function createIframe(iframeUrl, errorCallback) {\n    var iframe = global.document.createElement('iframe');\n    var tref, unloadRef;\n\n    var unattach = function unattach() {\n      debug('unattach');\n      clearTimeout(tref);\n\n      try {\n        iframe.onload = null;\n      } catch (x) {}\n\n      iframe.onerror = null;\n    };\n\n    var cleanup = function cleanup() {\n      debug('cleanup');\n\n      if (iframe) {\n        unattach();\n        setTimeout(function () {\n          if (iframe) {\n            iframe.parentNode.removeChild(iframe);\n          }\n\n          iframe = null;\n        }, 0);\n        eventUtils.unloadDel(unloadRef);\n      }\n    };\n\n    var onerror = function onerror(err) {\n      debug('onerror', err);\n\n      if (iframe) {\n        cleanup();\n        errorCallback(err);\n      }\n    };\n\n    var post = function post(msg, origin) {\n      debug('post', msg, origin);\n      setTimeout(function () {\n        try {\n          if (iframe && iframe.contentWindow) {\n            iframe.contentWindow.postMessage(msg, origin);\n          }\n        } catch (x) {}\n      }, 0);\n    };\n\n    iframe.src = iframeUrl;\n    iframe.style.display = 'none';\n    iframe.style.position = 'absolute';\n\n    iframe.onerror = function () {\n      onerror('onerror');\n    };\n\n    iframe.onload = function () {\n      debug('onload');\n      clearTimeout(tref);\n      tref = setTimeout(function () {\n        onerror('onload timeout');\n      }, 2000);\n    };\n\n    global.document.body.appendChild(iframe);\n    tref = setTimeout(function () {\n      onerror('timeout');\n    }, 15000);\n    unloadRef = eventUtils.unloadAdd(cleanup);\n    return {\n      post: post,\n      cleanup: cleanup,\n      loaded: unattach\n    };\n  },\n  createHtmlfile: function createHtmlfile(iframeUrl, errorCallback) {\n    var axo = ['Active'].concat('Object').join('X');\n    var doc = new global[axo]('htmlfile');\n    var tref, unloadRef;\n    var iframe;\n\n    var unattach = function unattach() {\n      clearTimeout(tref);\n      iframe.onerror = null;\n    };\n\n    var cleanup = function cleanup() {\n      if (doc) {\n        unattach();\n        eventUtils.unloadDel(unloadRef);\n        iframe.parentNode.removeChild(iframe);\n        iframe = doc = null;\n        CollectGarbage();\n      }\n    };\n\n    var onerror = function onerror(r) {\n      debug('onerror', r);\n\n      if (doc) {\n        cleanup();\n        errorCallback(r);\n      }\n    };\n\n    var post = function post(msg, origin) {\n      try {\n        setTimeout(function () {\n          if (iframe && iframe.contentWindow) {\n            iframe.contentWindow.postMessage(msg, origin);\n          }\n        }, 0);\n      } catch (x) {}\n    };\n\n    doc.open();\n    doc.write('<html><s' + 'cript>' + 'document.domain=\"' + global.document.domain + '\";' + '</s' + 'cript></html>');\n    doc.close();\n    doc.parentWindow[module.exports.WPrefix] = global[module.exports.WPrefix];\n    var c = doc.createElement('div');\n    doc.body.appendChild(c);\n    iframe = doc.createElement('iframe');\n    c.appendChild(iframe);\n    iframe.src = iframeUrl;\n\n    iframe.onerror = function () {\n      onerror('onerror');\n    };\n\n    tref = setTimeout(function () {\n      onerror('timeout');\n    }, 15000);\n    unloadRef = eventUtils.unloadAdd(cleanup);\n    return {\n      post: post,\n      cleanup: cleanup,\n      loaded: unattach\n    };\n  }\n};\nmodule.exports.iframeEnabled = false;\n\nif (global.document) {\n  module.exports.iframeEnabled = (typeof global.postMessage === 'function' || typeof global.postMessage === 'object') && !browser.isKonqueror();\n}","map":{"version":3,"sources":["C:/Users/Thivagar/AppData/Roaming/npm/node_modules/expo-cli/node_modules/sockjs-client/lib/utils/iframe.js"],"names":["eventUtils","require","JSON3","browser","debug","process","env","NODE_ENV","module","exports","WPrefix","currentWindowId","polluteGlobalNamespace","global","postMessage","type","data","parent","stringify","windowId","createIframe","iframeUrl","errorCallback","iframe","document","createElement","tref","unloadRef","unattach","clearTimeout","onload","x","onerror","cleanup","setTimeout","parentNode","removeChild","unloadDel","err","post","msg","origin","contentWindow","src","style","display","position","body","appendChild","unloadAdd","loaded","createHtmlfile","axo","concat","join","doc","CollectGarbage","r","open","write","domain","close","parentWindow","c","iframeEnabled","isKonqueror"],"mappings":"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","sourcesContent":["'use strict';\n\nvar eventUtils = require('./event')\n  , JSON3 = require('json3')\n  , browser = require('./browser')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:utils:iframe');\n}\n\nmodule.exports = {\n  WPrefix: '_jp'\n, currentWindowId: null\n\n, polluteGlobalNamespace: function() {\n    if (!(module.exports.WPrefix in global)) {\n      global[module.exports.WPrefix] = {};\n    }\n  }\n\n, postMessage: function(type, data) {\n    if (global.parent !== global) {\n      global.parent.postMessage(JSON3.stringify({\n        windowId: module.exports.currentWindowId\n      , type: type\n      , data: data || ''\n      }), '*');\n    } else {\n      debug('Cannot postMessage, no parent window.', type, data);\n    }\n  }\n\n, createIframe: function(iframeUrl, errorCallback) {\n    var iframe = global.document.createElement('iframe');\n    var tref, unloadRef;\n    var unattach = function() {\n      debug('unattach');\n      clearTimeout(tref);\n      // Explorer had problems with that.\n      try {\n        iframe.onload = null;\n      } catch (x) {\n        // intentionally empty\n      }\n      iframe.onerror = null;\n    };\n    var cleanup = function() {\n      debug('cleanup');\n      if (iframe) {\n        unattach();\n        // This timeout makes chrome fire onbeforeunload event\n        // within iframe. Without the timeout it goes straight to\n        // onunload.\n        setTimeout(function() {\n          if (iframe) {\n            iframe.parentNode.removeChild(iframe);\n          }\n          iframe = null;\n        }, 0);\n        eventUtils.unloadDel(unloadRef);\n      }\n    };\n    var onerror = function(err) {\n      debug('onerror', err);\n      if (iframe) {\n        cleanup();\n        errorCallback(err);\n      }\n    };\n    var post = function(msg, origin) {\n      debug('post', msg, origin);\n      setTimeout(function() {\n        try {\n          // When the iframe is not loaded, IE raises an exception\n          // on 'contentWindow'.\n          if (iframe && iframe.contentWindow) {\n            iframe.contentWindow.postMessage(msg, origin);\n          }\n        } catch (x) {\n          // intentionally empty\n        }\n      }, 0);\n    };\n\n    iframe.src = iframeUrl;\n    iframe.style.display = 'none';\n    iframe.style.position = 'absolute';\n    iframe.onerror = function() {\n      onerror('onerror');\n    };\n    iframe.onload = function() {\n      debug('onload');\n      // `onload` is triggered before scripts on the iframe are\n      // executed. Give it few seconds to actually load stuff.\n      clearTimeout(tref);\n      tref = setTimeout(function() {\n        onerror('onload timeout');\n      }, 2000);\n    };\n    global.document.body.appendChild(iframe);\n    tref = setTimeout(function() {\n      onerror('timeout');\n    }, 15000);\n    unloadRef = eventUtils.unloadAdd(cleanup);\n    return {\n      post: post\n    , cleanup: cleanup\n    , loaded: unattach\n    };\n  }\n\n/* eslint no-undef: \"off\", new-cap: \"off\" */\n, createHtmlfile: function(iframeUrl, errorCallback) {\n    var axo = ['Active'].concat('Object').join('X');\n    var doc = new global[axo]('htmlfile');\n    var tref, unloadRef;\n    var iframe;\n    var unattach = function() {\n      clearTimeout(tref);\n      iframe.onerror = null;\n    };\n    var cleanup = function() {\n      if (doc) {\n        unattach();\n        eventUtils.unloadDel(unloadRef);\n        iframe.parentNode.removeChild(iframe);\n        iframe = doc = null;\n        CollectGarbage();\n      }\n    };\n    var onerror = function(r) {\n      debug('onerror', r);\n      if (doc) {\n        cleanup();\n        errorCallback(r);\n      }\n    };\n    var post = function(msg, origin) {\n      try {\n        // When the iframe is not loaded, IE raises an exception\n        // on 'contentWindow'.\n        setTimeout(function() {\n          if (iframe && iframe.contentWindow) {\n              iframe.contentWindow.postMessage(msg, origin);\n          }\n        }, 0);\n      } catch (x) {\n        // intentionally empty\n      }\n    };\n\n    doc.open();\n    doc.write('<html><s' + 'cript>' +\n              'document.domain=\"' + global.document.domain + '\";' +\n              '</s' + 'cript></html>');\n    doc.close();\n    doc.parentWindow[module.exports.WPrefix] = global[module.exports.WPrefix];\n    var c = doc.createElement('div');\n    doc.body.appendChild(c);\n    iframe = doc.createElement('iframe');\n    c.appendChild(iframe);\n    iframe.src = iframeUrl;\n    iframe.onerror = function() {\n      onerror('onerror');\n    };\n    tref = setTimeout(function() {\n      onerror('timeout');\n    }, 15000);\n    unloadRef = eventUtils.unloadAdd(cleanup);\n    return {\n      post: post\n    , cleanup: cleanup\n    , loaded: unattach\n    };\n  }\n};\n\nmodule.exports.iframeEnabled = false;\nif (global.document) {\n  // postMessage misbehaves in konqueror 4.6.5 - the messages are delivered with\n  // huge delay, or not at all.\n  module.exports.iframeEnabled = (typeof global.postMessage === 'function' ||\n    typeof global.postMessage === 'object') && (!browser.isKonqueror());\n}\n"]},"metadata":{},"sourceType":"script"}